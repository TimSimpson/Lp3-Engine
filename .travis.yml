language: cpp

dist: trusty
sudo: false


addons:
  apt:
    sources:
      - ubuntu-toolchain-r-test
      - llvm-toolchain-precise
    packages:
      # - clang-3.8
      # - clang-format-3.8
      # - clang-tidy-3.8
      - libstdc++6
      - ninja-build
      # - python-pip
      - libboost-dev

matrix:
  include:
    - os: linux
      compiler: gcc
      addons:
        apt:
          sources:
            - ubuntu-toolchain-r-test
          packages:
            - gcc-6
            - g++-6
            - libfreetype6-dev
      env:
        - CENV_NAME=gcc64r
          CI_C=gcc-6
          CI_CXX=g++-6
          CI_BUILD_TYPE=Release
    - os: linux
      compiler: gcc
      addons:
        apt:
          sources:
            - ubuntu-toolchain-r-test
          packages:
            - gcc-6
            - g++-6
            - libfreetype6-dev
      env:
        - CENV_NAME=gcc64d
          CI_C=gcc-6
          CI_CXX=g++-6
          CI_BUILD_TYPE=Debug


install:
  - |
    set -e
    pushd /tmp
    travis_retry wget --quiet --no-check-certificate https://cmake.org/files/v3.8/cmake-3.8.0-rc2-Linux-x86_64.tar.gz
    tar -xf cmake-3.8.0-rc2-Linux-x86_64.tar.gz
    git clone https://github.com/TimSimpson/cenv.git
    travis_retry wget --quiet https://github.com/TimSimpson/cenv/archive/master.tar.gz
    tar -xf master.tar.gz
    pushd cenv-master
    ./install.sh
    popd
    popd

# before_script:
#   - export PATH=/tmp/cmake-3.8.0-rc2-Linux-x86_64/bin:${PATH}
#   - source /tmp/cenv-master/resources/bash-support.sh

script:
  - |
    set -e
    export PATH=/tmp/cmake-3.8.0-rc2-Linux-x86_64/bin:/tmp/cenv-master/output/bvenv/bin/:${PATH}
    echo Hai
    echo '^__^'
    cmake --version
    git submodule update --init --recursive
    cget init -DCMAKE_C_COMPILER=${CI_C} -DCMAKE_CXX_COMPILER=${CI_CXX} -DCMAKE_BUILD_TYPE=${CI_BUILD_TYPE}
    cget install -f requirements.txt
    mkdir build
    cd build
    cmake -G Ninja -DCMAKE_TOOLCHAIN_FILE=../cget/cget/cget.cmake -H../standalone -B./
    cmake --build ./
    ctest
